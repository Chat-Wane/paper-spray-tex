
\section{Background and motivations}
\label{sec:background}

This section introduces the general outlines of the random peer sampling
protocols. Then, it details two state-of-the-art approaches that will be used
later on. Finally, we highlight the motivations of our approach.

\subsection{Random peer sampling}
Random peer sampling protocols~\cite{jelasity2004peer} provide each peer with a
partial view $\mathcal{P}$ of the network membership $N$. The partial views are
populated with a uniform distribution of randomly chosen peers. A wide variety
of gossip-based protocols use random peer sampling (e.g. topology management
(REF)). Nonetheless, providing each peer with a uniform random sample relying
solely on local knowledge remains challenging (REF?).  Our \SCAMPLON{} protocol
is based on two state-of-the-art approaches, namely \SCAMP{} and \CYCLON{}.

%% Talk about Cyclon
\begin{asparadesc}
\item [Cyclon]\cite{voulgaris2005cyclon} is a periodic random peer sampling
  protocol which updates its partial view every interval of time. The partial
  view has a fixed-size set at start. In this view, each neighbour is
  associated with an age incremented at each cycle. To update its partial view,
  \CYCLON{} exchanges a subset of its partial view with one of its neighbour
  chosen using the age.  Assuming a well chosen $|\mathcal{P}|$, \CYCLON{}
  quickly converges to a random graph (cf. (REF experiments)) providing
  desirable properties such as robustness (MOAR) etc.
  Figure~\ref{fig:cyclonexample} depicts the periodic exchanges of
  \CYCLON{}. We can see that peers only communicate in their direct
  neighbourhood to renew connections.
\end{asparadesc}

\begin{figure}
  \centering
  \input{./input/cyclonexample.tex}
  \caption{\label{fig:cyclonexample}Example of \CYCLON{}'s periodic exchange of
    partial views. For simplicity sake, we set $|\mathcal{P}|$ to $4$ and the
    exchanges concern only $2$ neighbours. Furthermore, while the network
    contains $9$ members, we only show the partial views of $p_1$ and $p_5$.
    Peer $p_1$ initiates the view exchange with its oldest neighbour $p_5$,
    giving $\left\{p_1,\,p_2\right\}$. On receipt, Peer $p_5$ establishes the
    connection to $p_1$ and $p_2$ and gives away its connection to
    $\left\{p_6,\,p_9\right\}$.  On receipt of this latter, $p_1$ establishes
    the connection to Peer $p_6$ and Peer $p_9$. Altogether, we cut $4$ links
    to create $4$ other links only by using neighbour-to-neighbour
    interactions.}
\end{figure}

%% Talk about Scamp
\begin{asparadesc}
\item [Scamp]\cite{ganesh2001scamp,ganesh2003peer} stands for SCalable
  Membership Protocol. This protocol links each membership event with an
  appropriate reaction.  The most important event is the joining event which
  creates a logarithmically increasing number of connections compared to the
  total network size.  Figure~\ref{fig:scampexample} depicts the joining
  protocol of \SCAMP{}. As we can see, the resulting graph is
  connected. However, the last peer $p_1$ only has one neighbour in its partial
  view, meaning that if $p_2$ crashes, $p_1$ cannot send messages to the
  network any more. To avoid that, a periodic re-subscription is
  necessary. This re-subscription mechanism will likely add new neighbours in
  the partial view of the newest peers and reorganise the neighbourhood of
  oldest peer. Just as \CYCLON{}, \SCAMP{} converges to a random graph and
  provide their desirable properties.
\end{asparadesc}

\begin{figure}
  \centering
  \input{./input/scampexample.tex}
  \caption{\label{fig:scampexample} \SCAMP{}'s joining protocol on a small
    network with an identical legend to Fig~\ref{fig:cyclonexample}. Peer $p_1$
    wants to join $p_2$'s network composed of $p_2$, $p_3$, $p_4$, and
    $p_5$. Peer $p_1$ establishes a connection to $p_2$. Then $p_2$ copies
    $|\mathcal{P}|$-times the new subscription and sends one to each
    neighbour. To handle possible failures, $c$ additional copies (here $0$ for
    simplicity sake), are sent to random neighbours. Then, each peer has a
    probability of $1\over{|\mathcal{P}|+1}$ to accept the forwarded
    subscription, hence, to establish a connection to reach $p_1$. Otherwise,
    the peer forwards it to another peer in $\mathcal{P}$ at random. Here,
    $p_3$ accepts the subscription, $p_5$ forwards it to $p4$, and the latter
    accepts it. The resulting graph is connected.}
\end{figure}

\subsection{Three-way handshake}
In this paper, we do not restrict ourselves to one-way connections. We are 
also interested in three-way handshake connection set-up. In such context, 
a subscription message must be
\begin{inparaenum}[(1)]
\item emitted at Peer $p$,
\item accepted at Peer $q$,
\item completed at Peer $p$.
\end{inparaenum}
Thus, when a peer needs to establish a connection to another peer, a message
must travel back and forth. One could use a dedicated server to establish the
dialog. Nevertheless, this solution does not scale when each peer in the
network must repeatedly renew connections over time, which is an expected
behaviour of random peer sampling protocols. On the other hand, using the built
network itself to properly exchange the subscription messages seems
appropriate. Figure~\ref{fig:handshakeexample} depicts how it can be performed
in \CYCLON{} and \SCAMP{}. As we can see, \CYCLON{} subscription messages
always travel two hops away from their origin, while \SCAMP{} subscription
messages can travel longer ($k$ hops where $k$ is in average $log(N)$).  This
difference deeply impacts performances of \SCAMP{} as detailed hereafter, while
\CYCLON{} suffers from other flaws.

\begin{figure}
  \centering
  \input{./input/handshakeexample.tex}
  \caption{\label{fig:handshakeexample}Handshaking differences of \CYCLON{} and
    \SCAMP{}. While subscriptions travel from $p_1$ to $p_3$ using one
    intermediate in \CYCLON{}, the subscriptions travel from $p_1$ to $p_k$ in
    \SCAMP{}. This difference change the complexity of the two approaches. In
    particular, the failure probability is much more important in
    \SCAMP{}. Indeed, links and peers, once employed, must be kept alive until
    the subscriptions travel back. Otherwise, the handshaking is not complete.}
\end{figure}


\subsection{Motivations}
The establishment of connections using 3-way hanshaking forces a round-trip
negotiation much more costly and subject to failure compared to 1-way
connection. In this context, each connection matters. Hence, we cannot afford
oversized partial views like in \CYCLON{}. For instance, considering an
application usable by small or large groups of users indifferently, \CYCLON{}
will overestimate to adapt to the largest groups. While it is required for
these latter, the small groups of users will suffer of increased traffic
(maintaining the oversized views, broadcasting with increased redundancy
(NOTSURE)) . If the group is small enough, the graph could be fully connected
which is undesirable.

As consequence, one would be tempted to use \SCAMP{} since it provides a
logarithmically growing number of connections. However, the \SCAMP{}
subscription mechanism can create connections several hops away from its origin
(c.f. Fig~\ref{fig:handshakeexample}. Unfortunately, each of these hops is an
opportunity to failures.

Let $P_f$ the probability of either the peer or the link between the latter and
the next peer crashes/disconnects when it holds the subscription, without
possible recovery. Let $P_E$ the probability that a connection establishment
cannot be completed. Without 3-way handshake, $P_E$ is straightforward:
\begin{equation} P_{E,\,1way}^{CYCLON}=1-(1- P_f)^2 \end{equation}
\begin{equation} P_{E,\,1way}^{SCAMP}=1-(1- P_f)^{k+1} \end{equation} where $k$
is the number of hops before the acceptance of the subscription, i.e., there
are 2 hops at least. Indeed, the first peer cannot directly accept the
subscription. On the other hand, in the handshaking context, the subscription
must travel back to its origin in order to be completed. As consequence, when a
subscription travels through a peer or a link, they are not allowed to fail
until the subscription travels back. Thus, we obtain:
\begin{equation} P_{E,\,3way}^{CYCLON}=1-(1- P_f)^6\end{equation}.
\begin{align} P_{E,\,3way}^{SCAMP} &=1 - ((1-P_f)^{2(k+1)} (1-P_f)^{2k}
                                     \ldots (1-P_f)^2) \\
                                   &=1-(1-P_f)^{k^2+3k+2}
\end{align}
From these analysis, it is worth noting that while \CYCLON{} remains at a same
order of magnitude in both cases, \SCAMP{} is dramatically impacted. To sustain
these theoretical analysis, we conducted series of experiments to highlight the
differences between the contexts and the influence of failures on convergence
speed (INSERT GRAPH).

To summarise, we would like the best of the aforementioned approaches: a random
peer sampling protocol providing a logarithmically growing partial view size
compared to the network membership, using neighbour-to-neighbour interactions
to establish connections, quickly converging to a random network.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../paper"
%%% End:
