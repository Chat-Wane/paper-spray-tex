\section{Experimentation}
\label{sec:experiments}

In this section we examine the properties of \SPRAY{} and compare them to a
state-of-the-art fixed-size partial view approach, namely \CYCLON{}. We focus
on the adaptiveness of \SPRAY{}. The measurements concern common properties of
random graphs:
\begin{itemize}
\item the clustering coefficient: show the convergence speed, how scattered
  are the peers from each other, how close are the peer from partitioning.
\item the average minimum path length: show the efficiency of information
  dissemination.
\item the distribution of the incomming arcs: show how much the peers appear
  in the others' partial view.
\end{itemize}
Then, in a more dynamic context, the measurements concern:
\begin{itemize}
\item the arcs count: show the adaptiveness to the network size.
\item the variance of the partial view size: show the convergence speed under
  network dynamic change.
\item the number of connected components: show the robustness to massive
  failures, show where the network is beyond self-repairing.
\end{itemize}
Finally, the experiments highlight the small overhead of our approach by
measuring the number of duplicates inside the partial view sizes.

The experiments run on the \PEERSIM{}
simulator~\cite{montresor2009peersim}. The code of the random peer sampling
protocols \CYCLON{}, \SCAMP{}, and \SPRAY{} is available on Github
plateform~\footnote{https://github.com/justayak/peersim-spray}.

\subsection{Clustering coefficient}
\label{subsec:cluster}

\begin{figure}
  \centering
  \includegraphics[width=0.49\textwidth]{img/cluster.eps}
  \caption{\label{fig:clustering}The clustering coefficient of \CYCLON{} and
    \SPRAY{}: the x-axis denotes the elapsed time in cycles while the y-axis
    denotes the $\log_{10}$-scaled clustering coefficient.}
\end{figure}

\begin{asparadesc}
\item[Objective:] To show that \SPRAY{} converges faster than fixed-size
  approaches. To show that \SPRAY{} and the state-of-the-art representative
  (\CYCLON{}) converge to an equivalent network overlay when the latter is
  optimally configured. To show that both approaches converge to characteristic
  values of random graphs.
\item[Description:] The average clustering coefficient $\overline{C}$ measures
  the connectivity of each peer's neighborhood in the network.
  \begin{equation}
    \overline{C} = {1\over |\mathcal{N}|}\sum\limits_{x\in\mathcal{N}}C_x
  \end{equation}
  where $C_x$ is the local clustering coefficient of Peer $p_x$.  The runs
  concern 0.1k, 1k, 10k and 100k peers. The representative of fixed-size
  approach is \CYCLON{} which is optimally configured for 1k peers. Indeed, its
  partial views are set to $\ln(1000)\approx 7$. During their exchange, the
  peers using \CYCLON{} shuffle $3$ out of their $7$ neighbors. Thus, \CYCLON{}
  is oversized for 0.1k peers and undersized for 10k peers and 100k peers.

  % The higher the coefficient, the more likely the network contains cliques.
  % To satisfy the random peer sampling objective it is desired that the
  % network
  % has
  % few clusters, thus has a sufficiently low clustering coefficient.  This is
  % important for various reasons. First, highly clustered networks show poor
  % load-balancing when messages are broadcast as peers have a high chance of
  % receiving a message multiple times through their neighbors. Second: a
  % network
  % consisting of poorly connected clusters is less robust regarding peers
  % failing or simply leaving the overlay to disconnect the graph.

\item[Results:] Figure~\ref{fig:clustering} shows that \SPRAY{} converges
  faster than \CYCLON{}. Furthermore, when the number of peers in the network
  grows, the convergence speed of \CYCLON{} suffers heavily. On the contrary,
  \SPRAY{} converges very quickly independently of the network
  size. Figure~\ref{fig:clustering} also shows that both the approaches
  converge to a low clustering coefficient which is characteristic of random
  graphs. Nevertheless, \CYCLON{} and \SPRAY{} do not raise the same values
  after convergence. Indeed, excepted the number of peers where \CYCLON{} is
  optimally configured, \SPRAY{}'s values are either below (when \CYCLON{} is
  oversized) or above (when \CYCLON{} is undersized).  Overall, it shows that
  \SPRAY{} is
  \begin{inparaenum}
  \item faster to converge to a clustering coefficient
  \item reflecting the needs of the network membership.
  \end{inparaenum}
  It impacts both load-balancing and robustness to churn (when peers join and
  leave the network freely).
\item[Reasons:] The fact that \CYCLON{} converges slower is due to its partial
  view and the size of the shuffle. When they are \emph{a priori} configured,
  they constitute a constraint to the convergence speed.  Next, the clustering
  coefficient measures how much the neighborhood of each peer is connected to
  the rest of the network. It directly depends of the partial view size of each
  peer which, in \CYCLON{}, is fixed. Thus, when the peers number is multiplied
  by $10$, the clustering coefficient after convergence is divided by $10$. On
  the other hand, the peers using \SPRAY{} have variable-size partial view
  which gently reflects the network size with a logarithimic growth. Thus, when
  the network has 1000 peers, the partial view size adapts to this network
  size: \TODO{SIZE}. It explains the slightly higher clustering coefficient of
  \SPRAY{} on this run (i.e. \TODO{SIZE} vs 7).
\end{asparadesc}

\subsection{Average path length}
\label{subsec:avg}
\begin{figure}
  \centering
  \includegraphics[width=0.49\textwidth]{img/avgpath.eps}
  \caption{\label{fig:avgpath}Comparison of the average shortest path in \SPRAY{}
      and \CYCLON{}. The x-axis denotes the $\log_{10}$-scaled number of peers in 
      the overlay while the average shortest path of the graph is displayed on the 
  y-axis.}
\end{figure}

\begin{asparadesc}
\item[Objective:] In this experiment we examine the shortest path length that
  peers have to all other nodes in the network.  Messages should disseminate
  quickly into the network which makes it crucial that the shortest path to
  other peers is, in fact, short.
\item[Description:] The average path length is the average of the shortest path
  length between peers in the graph. It counts the minimum number of hops to
  reach a peer from another given peer.  For performance reasons, we select a
  subset of 7 nodes, calculate their average shortest path and average it by 7.
\item[Results:] Figure~\ref{fig:avgpath} shows that \CYCLON{}, when oversized,
  yield a shorter average path length then \SPRAY{} but is quickly exceeded
  when undersized.
  %after its optimal partial view size is exceeded \SPRAY{} yields a shorter
  %path.
\item[Reasons:] While oversized \CYCLON{} is much better connected into the
  graph and thus yields a lower average path length then \SPRAY{}, as soon
  as it is undersized, \SPRAY{} is, thanks to bigger partial views, better
  connected into the graph and, consequently, yields the shorter average path
  length. 
\end{asparadesc}

\subsection{Partial view size distribution}
\label{subsec:dist}

\begin{figure}
  \centering
  \includegraphics[width=0.49\textwidth]{img/histo.eps}
  \caption{\label{fig:histo}The in-degree distribution of \CYCLON{} and \SPRAY{}.
  The x-axis denotes the in-degree in number of nodes while the y-axis indicates 
  how much of the network features the given in-degree.}
\end{figure}

\begin{asparadesc}
\item[Objective:]
    As the degree distribution shows the existence of both,
  weakly connected peers as well as strongly connected hubs, it helps to
  analyze the robustness of the overlay when failure is present.  Additionally,
  it indicates how well-distributed links in the network are which
  helps to approximate the resource usage across peers.
\item[Description:]
    As the overlay can be represented as a directed graph we
  distinguish between out-degree which determines to how many other nodes a
  peer points, and the in-degree which determines from how many other peers a
  certain peer is referenced.  We concentrate on the in-degree for better
  comparison as in \CYCLON{} the out-degree is fixed ($c$).
\item[Results:] Figure~\ref{fig:histo} shows the in-degree distribution of
  \CYCLON{} and \SPRAY{}.  In \CYCLON{} the number of peers in the overlay
  has no influence on the degree distribution always as it always gathers
  around the selected partial view size $c$.  In \SPRAY{}, however, the
  degree distribution depends logarithmically on the network size and grows and
  shrinks with the network.
\item[Reasons:] \CYCLON{}'s fixed partial view size accounts for its rigid
  behavior.  In \SPRAY{} the distribution is much more fluid...
\end{asparadesc}

\subsection{Dynamic network}

\begin{figure}
  \centering
  \includegraphics[width=0.49\textwidth]{img/churn.eps}
  \caption{\label{fig:churn}\SPRAY{} under examplatory churn: the x-axis denotes
      the elapsed time in cylces. The upper graphs y-axis shows the
      number of total connections in the overlay while the lower graph y-axis shows
      the variance $\sigma^2$ of the partial view sizes $|\mathcal{P}|$ in the network.
      $2500$ peers join the network at cycle $0$, $10$, $20$, $30$, $60$ and $70$
      while $5000$ peers are removed in cycle $40$
  }
\end{figure}

\begin{asparadesc}
\item[Objective:] To highlight that \SPRAY{} is adaptive, i.e., the total
  number of connections reflects the network membership. Furthermore, the
  connections are quickly spread among the members.
\item[Description:] The first half of the experimentation, $2,500$ peers are
  added $4$ times successively by intervals of $10$ cycles each. Thus, the
  network size goes from $0$ to $10,000$ peers in $40$ rounds. Then, half of
  the network leaves without giving notice ($5,000$ peers). Finally, $2,500$
  peers join two additional times. The final network size is $10,000$
  members. The measurements concern
  \begin{inparaenum}
  \item the number of connections in the network over cycles,
  \item the variance of the partial view sizes over cycles
    (cf. Section~\ref{subsec:cyclic}).
  \end{inparaenum}
\item[Results:] Figure~\ref{fig:churn} shows the result of the experiment. The
  x-axis represents the cycles (i.e. the arbitrary unit time frame). The top
  figure shows the number of connections established in the network (scale
  $\times 10^3$). The bottom figure shows the variance in the partial view size
  of the members. We can see that at each batch of joinings, the connection
  number grows to reflect the needs of the new network membership. The
  observation is consistent with the variance measures. Indeed, at each batch
  of insertions, the variance suddenly grows. Then, it exponentially decreases
  and converges to zero in less than $10$ cycles. The variance is higher when
  the network size is lower. For instance, the first $2,500$ peers lead to the
  highest variance. At the $40^{th}$ rounds, half of the peers
  leave/crash. Around half of the connections are directly removed without
  disturbing the variance of partial views. The $10$ following cycles show a
  slight decrease of connections. Then new members are introduced in the
  network yielding the same results as earlier joinings.
\item[Reasons:] Since the partial views of \SPRAY{} adapt themselves to the
  network size, the number of connections grows as the network membership
  grows.  The peaks in variance correspond to the joining parts of the
  experiment. The disparity comes from the fact that new peers arrive in the
  network with a small partial view. The peaks are smaller when the network is
  larger. Indeed, the peers - which already were network members before the new
  arrivals - had a few rounds to exchanges and even up their partial views. As
  consequence, it lessens the weight of joinings. The removal of $5,000$ peers
  do not disturb the variance since they are made at random. Thus, no peers
  suffer more of these removals than others. The slightly decreasing number of
  connections after the removal is due to peers realizing that some connections
  are dead, leading to a probabilistic removal
  (cf. Algorithm~\ref{algo:unreachable}).
\end{asparadesc}

\subsection{Massive failures}
\label{subsec:resilience}

\begin{figure}
  \centering
  \includegraphics[width=0.49\textwidth]{img/resilience.eps}
  \caption{\label{fig:resilience}Resilience to massive failure}
\end{figure}


\begin{algorithm}
\input{input/unsubscriptionalgo.tex}
\caption{\label{algo:unsubscription}Unsubscription protocol from
  \SCAMP{}~\cite{ganesh2003peer}}
\end{algorithm}

\begin{asparadesc}
\item[Objective:] 
\item[Description:] Algorithm~\ref{algo:unsubscription} shows the
  unsubscription protocol which guarantees connectedness (WITH HIGH PROBA?)
  upon the assumption that an \emph{in view} $\mathcal{I}$ is maintained
  (cf. Line~\ref{line:inview}) along with bidirectional connections. The set of
  peers which have a particular peer in their partial view populate the
  latter's in view. When a peer leaves, it actively contributes to repair the
  network by acting like a bridge between its in view $\mathcal{I}$ and its
  partial view $\mathcal{P}$. As consequence, the neighbors from $\mathcal{I}$
  add each peer from the leaving peer's partial view in their own partial view.
  Except for one peer (cf. Line~\ref{line:bridge}), it guarantees that these
  peers stay connected, i.e., that at least one partial view references them.

\item[Results:]
\item[Reasons:]
\end{asparadesc}

\subsection{Degeneration}

\begin{figure}
  \centering \includegraphics[width=0.49\textwidth]{img/degen.eps}
  \caption{\label{fig:degen}Degeneration of static network} \end{figure}

\begin{asparadesc} \item[Objective:] \SPRAY{}, especially when using
        \emph{handshaking}, is vulnerable to message loss. When messages can
        be lost, a static \SPRAY{} overlay where peers neither join
        nor leave will slowly degenerate.
        The reason for this can be found in Algorithm~\ref{algo:unreachable} 
        where arcs are potentially lost when a message is lost.
        Protocols with fixed partial view sizes like \CYCLON{} are not prone 
        to this degeneration as they can easily repair lost arcs.
        For this reason, we compare with another adaptive probabilistic protocol,
        \SCAMP{}, instead. We adapted \SCAMP{} so that its lease-mechanism preserves
        the total number of arcs in the network.
        This experiment focuses on two features: the total number of arcs in the 
        graph and the number of weak components.
\item[Description:]
    As previously shown, the number of arcs in the network should be
    $|\mathcal{N}|\log{|\mathcal{N}|}$ for the overlay to be robust. A weak
    component $\mathcal{W}$ of a graph $G$ is a maximum subgraph where the direction
    is ignored.
    Naturally, we want the number of weak components $|\mathcal{W}|$ to be $1$,
    meaning that the whole network is connected.
    When the overlay consists of more than one component, the network is disconnected.
    Unlike with strong component where the direction is taken into account, \SPRAY{}
    cannot repair itself when more than one weak component is present.
    The experiment involves handshaking and is conducted with an overlay consisting
    of $10,000$ peers over a period of $100,000$ cycles and a probability of
    $\frac{1}{1000}$ that a link fails. \TODO{BRICE: PLEASE ELABORATE YOUR CALCS}

\item[Results:]
    The x-axis in Figure~\ref{fig:degen} shows the number of cycles the protocol was
    executed.
    The upper graphs y-axis represents the total number of arcs in the
    overlay while the lower graphs y-axis shows the percentage that weak components
    make up of the total network: $\frac{|\mathcal{W}|}{|\mathcal{N}|}$.
    We clearly see that \SPRAY{} degenerates much slower than \SCAMP{} and that
    it becomes disconnected very late while \SCAMP{} collapses quickly.

\item[Reasons:]
    As \SCAMP{} must maintain much more links than \SPRAY{} when establishing a
    connection it has a higher probability of losing arcs which, in turn, let it
    degenerate much quicker.
    Furthermore, while in \SPRAY{} we can easily predict if a link failed or if
    the node failed and thus we can stop the degeneration this is not possible in
    \SCAMP{} as it cannot be predicted easy for when a link failed due to its
    random walk nature.

\end{asparadesc}

\subsection{Duplicates in Partial Views}

\begin{figure}
  \centering \includegraphics[width=0.49\textwidth]{img/dupl.eps}
  \caption{\label{fig:dupl}
  Duplicates in Networks of different size: the x-axis denotes the elapsed time
  in cycles while the $log_{10}$-scaled y-axis denotes the share of the nodes that
  have more than one pointer to the same node in their partial view.
  } \end{figure}

\begin{asparadesc} 
\item[Objective:]
    \SPRAY{}`s only constraint for a peers partial view is that it must not contain
    self-loops, however, multiple links to the same peer different from oneself
    are explicitly allowed.
    This characteristic strongly distinguishes \SPRAY{} from \CYCLON{} and other 
    \emph{random peer sampling services} who ensure that only one link per peer exists.
    We want to avoid duplicates in partial views for two obvious reasons:
    First, it lowers the robustness: when a peer $a$ references another peer $b$ 
    multiple times and peer $b$ leaves the network than $a$ will lose not one but 
    multiple links and thus making \SPRAY{} potentially more disruptive than 
    its sibling protocols.
    Second, duplicates might be problematic for protocols that make use of \SPRAY{} as
    a random peer sampling service. When used for broadcasting, unnecessary messages
    are sent which increases the network costs of the protocol.
    All of this demands a closer look on the behavior of duplicates.
\item[Description:]
    The experiment is conducted with networks of different size, ranging form 1000 
    to 1 million peers that all join at the same moment. We then examine the convergence
    of duplicates in the overlay, the results can be seen in Figure~\ref{fig:dupl}:
    The x-axis denotes the elapsed time in cycles while the y-axis denotes the share of
    nodes that contain duplicate links in their partial view.
\item[Results:]
    Figure~\ref{fig:dupl} indicates that all examined networks contain duplicates but
    that the relative count towards the network size gets smaller the bigger the overlay
    is. \TODO{ELABORATE WHAT KIND OF FUNCTION!}
\item[Reasons:]

\end{asparadesc}

%% \subsection{Synthesis}

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../paper"
%%% End:
