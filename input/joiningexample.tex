
\begin{tikzpicture}[scale=1.15]

  \newcommand\X{35pt};
  \newcommand\Y{15pt};
  \scriptsize
  \draw[->,dashed,thick](5+0*\X, 0*\Y) -- 
  node[anchor=south]{$1$}(-5+ 2*\X, 0*\Y);
  \draw[->] (-5+2*\X, 5pt) -- (5+\X, \Y);
  \draw[->] (-5+2*\X, 5pt) --
  node[anchor=south west]{$2$} (5+\X, 2*\Y);
  \draw[->] (-5+2*\X, -5pt) -- (5+\X, -\Y);
  \draw[->] (-5+2*\X, -5pt) --
  node[anchor=north west]{$2$}(5+\X, -2*\Y);

  \draw[->,dashed](-5+\X, 2*\Y) --
  node[anchor=south east]{$3$} ( 5pt,5pt);
  \draw[->,dashed](-5+\X, 1*\Y) -- ( 5pt,5pt);
  \draw[->,dashed](-5+\X, -1*\Y) -- ( 5pt,-5pt);
  \draw[->,dashed](-5+\X, -2*\Y) --
  node[anchor=north east]{$3$}( 5pt,-5pt);

  \small
  \begin{scope}[shift={(120pt,20pt)}]
    \draw[fill=white](5pt, 0pt)node{$p_x$}+(-5pt,-5pt) rectangle +(5pt,5pt);
    \draw (10pt,0pt) node[anchor=west]{Peer $p_x$};
    \draw[->](0pt, -12pt)--(10pt, -12pt) node[anchor=west]{Established link};
    \draw[->, densely dashed](0pt, -19pt)--(10pt, -19pt)
    node[anchor=west]{New link};

    \draw(0pt, -31pt)node[anchor=west]{$1$: $subs$};
    \draw(0pt, -38pt)node[anchor=west]{$2$: $fwdSubs$};
    \draw(0pt, -45pt)node[anchor=west]{$3$: $connects$};
  \end{scope}

  \normalsize
  \draw[fill=white, very thick]
  (0*\X, 0*\Y) node{$p_1$} +(-5pt,-5pt) rectangle +(5pt,5pt);
  \draw[fill=white, very thick]
  (2*\X, 0*\Y) node{$p_2$} +(-5pt,-5pt) rectangle +(5pt,5pt);

  \draw[fill=white](1*\X,2*\Y) node{$p_6$} +(-5pt,-5pt) rectangle +(5pt,5pt);
  \draw[fill=white](1*\X,1*\Y) node{$p_5$} +(-5pt,-5pt) rectangle +(5pt,5pt);
  \draw[fill=white](1*\X,-1*\Y) node{$p_4$} +(-5pt,-5pt) rectangle +(5pt,5pt);
  \draw[fill=white](1*\X,-2*\Y) node{$p_3$} +(-5pt,-5pt) rectangle +(5pt,5pt);
  


\end{tikzpicture}