
\section{Use case: real-time editing}
\label{sec:use-case}

In order to demonstrate the performance of \SPRAY in a real scenario,
we introduce \CRATE, a real-time editor that allows editing anytime
and anywhere, whatever the number of participants, without third
party. It can be used for small groups but also during events such as
massive online lectures, TV shows, conferences that gather larger
groups. Transitions between small groups and large groups is supported
transparently thanks to \SPRAY. Distributed real-time editing is a
pertinent context for \SPRAY; groups size are changing quickly and any
participant broadcasts anytime to all other participants.

\CRATE builds a network of browsers where each browsers is able to
communicate with a logarithmically scaling number of browsers compared
to the global network size. Each change performed on documents
transits neighbors to reach all members in a scalable
way~\cite{birman1999bimodal}. Contrarily to
state-of-the-art~\cite{tolgyeski2009adaptive, voulgaris2005cyclon},
\SPRAY allows the diffusion cost to adapt to the network size. Thus,
small networks do not pay the price of large networks.

Real-time distributed collaborative editors consider multiple participants, each
hosting a copy of a shared sequence of characters. A participant updates at any
time its local copy by inserting or deleting a character. Then, the operation is
eventually delivered to all other members. Finally, delivered operations are
re-executed~\cite{saito2005optimistic}. Consistency requires that all members
eventually converge to an identical state, i.e., when the system is idle, all
copies become similar~\cite{bailis2013eventual}.

\CRATE uses a sequence data structure that belongs to the class of Conflict-free
Replicated Data Types (CRDTs)~\cite{shapiro2011conflict,
  shapiro2011comprehensive}. It provides two commutative operations to update
documents: \emph{insert} and \emph{delete}.  They use totally ordered, unique,
and immutable identifiers associated to each character to guarantee consistent
copies of the document. % Nevertheless, they require storing these identifiers. In
% this paper, we focus on variable-size identifiers~\cite{preguica2009commutative,
%   weiss2009logoot}. Thus, identifiers are lists determined at generation.

% As for the content of messages, \CRATE uses a sequence data structure
% that guarantees eventually consistent documents, i.e., documents
% converge to an identical statew. It allocates
% an identifier to each element of the sequence representing the
% document.

\CRATE uses the allocation function \LSEQ~\cite{nedelec2013lseq} to keep the
space of these identifiers under a polylogarithmic bound compared to the
document size. As consequence, its upper bound on communication complexity is
$\mathcal{O}((\log d)^2\ln(|\mathcal{N}|))$ where $d$ is the document size and
$|\mathcal{N}|$ is the editing session size. To summerize, each time a
participant types a character, it broadcasts this character plus an identifier
to the editing session.

Compared to Google Docs, \CRATE is decentralized and preserves
privacy. It also supports any number of participants where Google Docs
allows only the first fifty users to edit in real-time. Additional
users have their rights limited to document reading.

\subsection{Architecture}

\begin{figure}
  \centering
  \input{input/architecture.tex}
  \caption{\label{fig:architecture}\CRATE's architecture comprises 4
    layers.}
\end{figure}

Figure~\ref{fig:architecture} depicts \CRATE's architecture which comprises four
layers:
\begin{inparaenum}[(i)]
\item communication: includes the editing session membership mechanism and the
  information dissemination protocols.
\item causality: includes the causality tracking
  structure~\cite{malkhi2007concise} that guarantees that the delivery of the
  removal of an element never precedes its insertion.
\item sequence structure: includes the structure that guarantees a global
  total order among elements of the sequence.
\item graphical user interface: includes the editor as a graphical entity that
  users can interact with inside web browsers.
\end{inparaenum}
Figure~\ref{fig:architecture} also depicts the process chain of \CRATE: when
users perform an operation on the document, the operation is applied to the
shared sequence which creates an \LSEQ identifier. Then it decorates the result
of the operation with causality tracking metadata. Finally, \CRATE broadcasts it
using the neighborhood provided by \SPRAY.  Conversely, when \CRATE receives a
broadcast message, it checks if the operation is causally ready to be
delivered. Once the condition is verified, it applies the operation to the
shared sequence which notifies the graphical user interface of the changes.

%% The rest of this section details the main components of \CRATE and their
%% respective contributions to complexities.


\subsection{Epidemic dissemination}
\label{subsec:gossiping}

Epidemic dissemination~\cite{birman1999bimodal,demers1987epidemic} (or
gossiping) relies on the membership protocol to propagate messages in a scalable
way to all members (broadcast).
Algorithm~\ref{algo:gossiping} shows the simple functioning of this
protocol. When a peer emits a message, it sends it to its neighborhood. Each
peer receiving such messages forwards it to its neighborhood too. Messages
transitively reach all peers of the network.

\begin{algorithm}[h]
  \input{./input/gossipingalgo.tex}
  \caption{\label{algo:gossiping}Epidemic dissemination protocol.}
\end{algorithm}

Since the gossiping algorithm depends of the neighborhood provided by \SPRAY,
and since the latter grows logarithmically compared to the network size, the
communication complexity of an application is upper-bounded by
$\mathcal{O}(m \ln |\mathcal{N}|)$, where $m$ is the space complexity of a
message. To scale, applications are in charge of keeping $m$ under a sublinear
upper bound.

% \subsection{Causality tracking}

% The role of causality tracking is twofold:
% \begin{inparaenum}
% \item guarantee the one time delivery and forwarding of broadcast messages
%   (cf. Line~\ref{line:alreadyreceived} of Algorithm~\ref{algo:gossiping}),
% \item guarantee that the removal of an element never precedes its insertion.
% \end{inparaenum}
% \CRATE uses a version vector with exceptions~\cite{malkhi2007concise}


\subsection{A scalable sequence data structure}

% Real-time distributed collaborative editors consider multiple participants, each
% hosting a copy of a shared sequence of characters. A participant updates at any
% time its local copy by inserting or deleting a character. Then, the operation is
% eventually delivered to all other members. Finally, delivered operations are
% re-executed~\cite{saito2005optimistic}. Consistency requires that all members
% eventually converge to an identical state, i.e., when the system is idle, all
% copies become similar.

% \CRATE uses a sequence data structure that belongs to the class of Conflict-free
% Replicated Data Types (CRDTs)~\cite{shapiro2011conflict,
%   shapiro2011comprehensive}. It provides two commutative operations to update
% documents: \emph{insert} and \emph{delete}.  They use totally ordered, unique,
% and immutable identifiers associated to each character to guarantee consistent
% copies of the document. Nevertheless, they require storing these identifiers. In
% this paper, we focus on variable-size identifiers~\cite{preguica2009commutative,
%   weiss2009logoot}. Thus, identifiers are lists determined at generation.

To generate its identifiers, \CRATE uses \LSEQ~\cite{nedelec2013lseq}, an
allocation function that provides identifiers enjoying a polylogarithmic upper
bound $\mathcal{O}((\log d)^2)$ on space complexity compared to the document
size $d$. 

\begin{figure}
  \centering
  \input{./input/lseqtreeexampleB.tex}
  \caption{\label{fig:lseqexample}\LSEQ data structure representing QWERTY.}
\end{figure}

\LSEQ factorizes identifiers into a tree structure. Each identifier is a path
leading to its character. A lexicographic total order among paths allows
retrieving the sequence of characters. Figure~\ref{fig:lseqexample} shows a data
structure example that represents the sequence QWERTY inserted backward, i.e.,
the Y, then W, etc. We observe that \LSEQ uses an exponential tree where each
element has twice as many children as its parent. Here, the path of Character Q
is the concatenation of Integers [0.44] which requires
$\log_2(32)+\log_2(64)=11$ bits to encode. It takes less and less space to
encode more and more identifiers. \CRATE sends the path along with uniqueness
markers and the character to all its neighbors where they will be both
integrated and forwarded. All member sends it once to their logarithmically
scaling neighborhood.

%%% Local Variables:
%%% mode: latex
%%% TeX-master: "../paper"
%%% End:
